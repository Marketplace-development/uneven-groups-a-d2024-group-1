{% extends 'base.html' %}

{% block head %}
<title>Make a Reservation</title>
{% endblock %}

{% block body %}
<div class="locations-container">
    <!-- Buttons in the right upper corner -->
    <div class="button-container" style="position: fixed; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 0px; z-index: 999;">
        <form action="{{ url_for('main.main_page') }}" method="get" class="inline-form">
            <button type="submit" class="btn btn-transparant" style="width: 200px; font-size: 1em; padding: 10px 20px;">Main Page</button>
        </form>
        <form action="{{ url_for('main.home') }}" method="get" class="inline-form">
            <button type="submit" class="btn btn-black" style="width: 200px; font-size: 1em; padding: 10px 20px;">Logout</button>
        </form>
    </div>

    <!-- Logo -->
    <div style="display: flex; justify-content: center; align-items: center; height: 100%; margin-top: 20px;">
        <img src="{{ url_for('static', filename='images/logo_wit.jpg') }}" alt="logo" style="width: 150px;">
    </div>

    <!-- Page title and subtitle -->
    <h1 style="text-align: center; color: black; font-size: 2.5em; font-weight: bold;">Make a Reservation</h1>
    <p style="text-align: center; color: grey; font-size: 1.5em;">Create a new reservation</p>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
        {% endif %}
    {% endwith %}

    <br>

    <!-- New Reservation Form -->
    <div class="form-wrapper">
        <form method="POST" action="{{ url_for('main.reservations') }}">
            <h3>Select a Location</h3>

            <!-- Check if the locations list is empty -->
            {% if locations|length == 0 %}
            <p style="font-size: 1.2em; color: #888; text-align: center; margin-top: 20px;">
                There are no locations available at the moment.
            </p>
            {% else %}
                <div class="location-grid">
                    {% for location in locations %}
                    <label>
                        <!-- Radio button for selecting a location -->
                        <input type="radio" name="location_id" value="{{ location.id }}" class="location-card-input" {% if location.id == selected_location_id %} checked {% endif %} required>
                        <div class="location-card">
                            <h3 style="font-size: 1.5em">{{ location.location_name }}</h3>
                            <img src="{{ url_for('static', filename='images/' ~ location.location_picture ~ '.jpg') }}" alt="Image of {{ location.location_name }}">
                            <p><strong>Type:</strong> {{ location.location_type }}</p>
                            <p><strong>Address:</strong>
                                {{ location.street }} {{ location.street_number }}, 
                                {{ location.postal_code }} {{ location.city }}, 
                                {{ location.country }}
                            </p>
                            <p><strong>Available Seats:</strong> {{ location.chairs }}</p>

                            <p><strong>Opening Hours:</strong></p>
                            <ul style="list-style-type: none; padding: 0; margin-top: 0;">
                                {% if location.monday_open and location.monday_close %}
                                    <li><strong>Monday:</strong> {{ location.monday_open }}h - {{ location.monday_close }}h</li>
                                {% else %}
                                    <li><strong>Monday:</strong> Closed</li>
                                {% endif %}

                                {% if location.tuesday_open and location.tuesday_close %}
                                    <li><strong>Tuesday:</strong> {{ location.tuesday_open }}h - {{ location.tuesday_close }}h</li>
                                {% else %}
                                    <li><strong>Tuesday:</strong> Closed</li>
                                {% endif %}

                                {% if location.wednesday_open and location.wednesday_close %}
                                    <li><strong>Wednesday:</strong> {{ location.wednesday_open }}h - {{ location.wednesday_close }}h</li>
                                {% else %}
                                    <li><strong>Wednesday:</strong> Closed</li>
                                {% endif %}

                                {% if location.thursday_open and location.thursday_close %}
                                    <li><strong>Thursday:</strong> {{ location.thursday_open }}h - {{ location.thursday_close }}h</li>
                                {% else %}
                                    <li><strong>Thursday:</strong> Closed</li>
                                {% endif %}

                                {% if location.friday_open and location.friday_close %}
                                    <li><strong>Friday:</strong> {{ location.friday_open }}h - {{ location.friday_close }}h</li>
                                {% else %}
                                    <li><strong>Friday:</strong> Closed</li>
                                {% endif %}

                                {% if location.saturday_open and location.saturday_close %}
                                    <li><strong>Saturday:</strong> {{ location.saturday_open }}h - {{ location.saturday_close }}h</li>
                                {% else %}
                                    <li><strong>Saturday:</strong> Closed</li>
                                {% endif %}

                                {% if location.sunday_open and location.sunday_close %}
                                    <li><strong>Sunday:</strong> {{ location.sunday_open }}h - {{ location.sunday_close }}h</li>
                                {% else %}
                                    <li><strong>Sunday:</strong> Closed</li>
                                {% endif %}
                            </ul>
                        </div>
                    </label>
                    {% endfor %}
                </div>

                <br>
                
                <div class="reservation-form-grid">
                    <!-- Username -->
                    <div class="form-field">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username" value="{{ current_user.username }}" required readonly>
                    </div>
            
                    <!-- Number of Guests -->
                    <div class="form-field">
                        <label for="number_of_guests">Number of Guests:</label>
                        <input type="number" id="number_of_guests" name="number_of_guests" placeholder="Enter the number of guests" min="1" required>
                    </div>
            
                    <!-- Reservation Time -->
                    <div class="form-field">
                        <label for="reservation_time">Reservation Time:</label>
                        <input type="datetime-local" name="reservation_time" id="reservation_time" required>
                    </div>
            
                    <!-- Study Time -->
                    <div class="form-field">
                        <label for="study_time">Study Time (in minutes):</label>
                        <input type="number" name="study_time" id="study_time" placeholder="Enter study time in minutes" min="30" required>
                    </div>
                </div>
        
                <div class="form-group">
                    <button type="submit" class="btn btn-black">Book Your Reservation</button>
                </div>
            {% endif %}
        </form>
    </div>
</div>
{% endblock %}
